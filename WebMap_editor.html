<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Debug OAuth - WebMap</title>
  <link rel="stylesheet" href="https://js.arcgis.com/4.26/esri/themes/light/main.css" />
  <script src="https://js.arcgis.com/4.26/"></script>
</head>
<body>
  <button id="loginBtn">üîê Iniciar sesi√≥n</button>
  <div id="viewDiv" style="width: 100%; height: 90vh;"></div>

  <script>
    require([
      "esri/identity/OAuthInfo",
      "esri/identity/IdentityManager",
      "esri/WebMap",
      "esri/views/MapView"
    ], function(OAuthInfo, esriId, WebMap, MapView) {

      console.log("üõ†Ô∏è Script cargado...");

      const CLIENT_ID = "6IysV3XMGJIa37Wa";
      const PORTAL_URL = "https://mapasydatos.maps.arcgis.com";
      const WEBMAP_ID = "8849d965dc3645fb88fb47daca23bed9";

      const info = new OAuthInfo({
        appId: CLIENT_ID,
        portalUrl: PORTAL_URL,
        popup: true
      });

      esriId.registerOAuthInfos([info]);

      document.getElementById("loginBtn").addEventListener("click", () => {
        console.log("üîê Iniciando login...");

        esriId.getCredential(PORTAL_URL + "/sharing")
          .then((credential) => {
            console.log("‚úÖ Login OK:", credential);

            const webmap = new WebMap({
              portalItem: { id: WEBMAP_ID }
            });

            const view = new MapView({
              container: "viewDiv",
              map: webmap
            });

            view.when(() => {
              console.log("üó∫Ô∏è WebMap cargado exitosamente");
            }).catch(err => {
              console.error("‚ùå Error al cargar WebMap:", err);
            });

          })
          .catch((err) => {
            console.error("‚ùå Error de autenticaci√≥n:", err);
            if (err.message === "ABORTED") {
              console.warn("‚ö†Ô∏è Login cancelado por el usuario o popup bloqueado.");
            }
          });
      });

    });
  </script>
</body>
</html>
