<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Test Token OAuth ArcGIS</title>
  <link rel="stylesheet" href="https://js.arcgis.com/4.26/esri/themes/light/main.css" />
  <script src="https://js.arcgis.com/4.26/"></script>
</head>
<body>
  <button id="loginBtn">ğŸ” Iniciar sesiÃ³n (ver token)</button>
  <pre id="output" style="padding: 1em; background: #f7f7f7;"></pre>

  <script>
    require([
      "esri/identity/OAuthInfo",
      "esri/identity/IdentityManager"
    ], function(OAuthInfo, esriId) {
      const CLIENT_ID = "6IysV3XMGJIa37Wa";
      const PORTAL_URL = "https://mapasydatos.maps.arcgis.com";

      const output = document.getElementById("output");

      const info = new OAuthInfo({
        appId: CLIENT_ID,
        portalUrl: PORTAL_URL,
        popup: true
      });

      esriId.registerOAuthInfos([info]);

      document.getElementById("loginBtn").addEventListener("click", () => {
        output.innerText = "ğŸ”„ Iniciando autenticaciÃ³n...";

        esriId.getCredential(PORTAL_URL + "/sharing")
          .then((credential) => {
            console.log("âœ… Autenticado");
            console.log(credential);
            output.innerText =
              `âœ… Login exitoso\n` +
              `Token: ${credential.token}\n` +
              `Usuario: ${credential.userId}\n` +
              `Expira: ${new Date(credential.expires).toLocaleString()}`;
          })
          .catch((err) => {
            console.error("âŒ Error:", err);
            output.innerText =
              `âŒ Error de autenticaciÃ³n\n` +
              `Mensaje: ${err.message}`;
          });
      });
    });
  </script>
</body>
</html>
