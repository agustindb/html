<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Login ArcGIS Manual</title>
  <link rel="stylesheet" href="https://js.arcgis.com/4.26/esri/themes/light/main.css" />
  <script src="https://js.arcgis.com/4.26/"></script>
</head>
<body>
  <button id="loginBtn">🔐 Iniciar sesión con ArcGIS</button>
  <div id="viewDiv" style="width: 100%; height: 90vh;"></div>

  <script>
    require([
      "esri/identity/OAuthInfo",
      "esri/identity/IdentityManager",
      "esri/WebMap",
      "esri/views/MapView"
    ], function(OAuthInfo, esriId, WebMap, MapView) {

      const CLIENT_ID = "6IysV3XMGJIa37Wa";
      const PORTAL_URL = "https://mapasydatos.maps.arcgis.com";

      const info = new OAuthInfo({
        appId: CLIENT_ID,
        portalUrl: PORTAL_URL,
        popup: true
      });

      esriId.registerOAuthInfos([info]);

      document.getElementById("loginBtn").addEventListener("click", () => {
        esriId.getCredential(PORTAL_URL + "/sharing")
          .then(() => {
            console.log("✅ Login exitoso");

            const webmap = new WebMap({
              portalItem: { id: "8849d965dc3645fb88fb47daca23bed9" }
            });

            const view = new MapView({
              container: "viewDiv",
              map: webmap
            });

            view.when(() => {
              console.log("📌 MapView listo");
            });
          })
          .catch(err => {
            console.error("❌ Error en login manual:", err);
          });
      });
    });
  </script>
</body>
</html>
